<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home - FintechApp</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/profileIcon.css}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">üè¶ FintechApp</div>
        <ul class="menu">
            <li class="active">Dashboard</li>
            <li><a th:href="@{/pagamenti}">Pagamenti</a></li>
            <li><a th:href="@{/carte}">Carte</a></li>
            <li><a th:href="@{/documenti}">Documenti</a></li>
            <li><a th:href="@{/impostazioni}">Impostazioni</a></li>
        </ul>
        <div class="logout"><a th:href="@{/logout}">Logout</a></div>
    </aside>

    <!-- Main content -->
    <main class="main">
        <header class="header">
            <div class="user-profile">
                <img th:src="@{/images/Profile.png}" alt="Profilo" id="profileIcon" class="profile-icon">
                <div id="userDropdown" class="dropdown-menu">
                    <ul>
                        <li><a th:href="@{/profilo}">Il mio profilo</a></li>
                        <li><a th:href="@{/documenti}">Documenti</a></li>
                        <li><a th:href="@{/impostazioni}">Impostazioni</a></li>
                        <li><a th:href="@{/logout}">Logout</a></li>
                    </ul>
                </div>
            </div>
        </header>

        <!-- Cards -->
        <section class="cards">
            <div class="card">
                <h3 th:text="${saldo} + ' ‚Ç¨'">0.00 ‚Ç¨</h3>
                <p>Saldo</p>
            </div>
            <div class="card">
                <h3 th:text="${entrate} + ' ‚Ç¨'">0.00 ‚Ç¨</h3>
                <p>Entrate</p>
            </div>
            <div class="card">
                <h3 th:text="${uscite} + ' ‚Ç¨'">0.00 ‚Ç¨</h3>
                <p>Uscite</p>
            </div>
<!--            <div class="card">-->
<!--                <h3 th:text="${risparmi} + ' ‚Ç¨'">0.00 ‚Ç¨</h3>-->
<!--                <p>Risparmi</p>-->
<!--            </div>-->
        </section>

        <section class="chart-section">
            <h3>Finanze (Ultimi 30 Giorni)</h3>
            <canvas id="financeChart"></canvas>
        </section>

        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!-- Inject aggregated movements into JS -->
        <script th:inline="javascript">
            /*<![CDATA[*/
                // Thymeleaf injects labels and data directly
                const labels = /*[[${chartLabels}]]*/ [];
                const data = /*[[${chartData}]]*/ [];

                const ctx = document.getElementById("financeChart").getContext("2d");
                new Chart(ctx, {
                    type: "line", // change to 'bar' if preferred
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Pagamenti (‚Ç¨)",
                            data: data,
                            borderColor: "rgba(75, 192, 192, 1)",
                            backgroundColor: "rgba(75, 192, 192, 0.2)",
                            fill: true,
                            tension: 0.3,
                            pointRadius: 4,
                            pointBackgroundColor: "red"
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: true },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => `‚Ç¨${ctx.raw}`
                                }
                            }
                        },
                        scales: {
                            x: { ticks: { maxRotation: 45, minRotation: 45 } },
                            y: { beginAtZero: true }
                        }
                    }
                });
            /*]]>*/
        </script>



        <!-- Transaction History -->
        <section class="transactions">
            <h3>Ultimi 5 Movimenti</h3>

            <div style="margin-bottom: 10px;">
                <a href="/api/movements/export/pdf" title="Scarica PDF" target="_blank" style="margin-right: 15px; text-decoration:none; color:#000;">
                    <!-- Icona PDF semplice -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#D32F2F" viewBox="0 0 24 24">
                        <path d="M6 2h9l5 5v15a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zM9 14h2v2H9v-2zm0-6h6v2H9v-2zm0 3h6v2H9v-2z"/>
                    </svg>
                </a>
                <a href="/api/movements/export/excel" title="Scarica Excel" target="_blank" style="text-decoration:none; color:#107C10;">
                    <!-- Icona Excel semplice -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#107C10" viewBox="0 0 24 24">
                        <path d="M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm1 3v12h2l3-4 3 4h2V6H6zm5.6 5.4L11 13l-1.6-1.6H11z"/>
                    </svg>
                </a>
            </div>

            <table>
                <thead>
                <tr>
                    <th>Destinatario</th>
                    <th>Importo</th>
                    <th>Causale</th>
                    <th>Data</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="movement : ${lastPayments}">
                    <td th:text="${movement.ibanReceiver}">IBAN Destinatario</td>
                    <td th:text="${movement.amount} + ' ‚Ç¨'">100 ‚Ç¨</td>
                    <td th:text="${movement.causale}">Causale</td>
                    <td th:text="${#temporals.format(movement.executionDate, 'dd/MM/yyyy HH:mm')}">22/07/2025</td>
                </tr>
                </tbody>
            </table>
        </section>

    </main>

<!--    &lt;!&ndash; Right panel &ndash;&gt;-->
<!--    <aside class="right-panel">-->
<!--        <div class="my-card">-->
<!--            <h3>La mia Carta</h3>-->
<!--            <div class="card-img">-->
<!--                <img src="https://via.placeholder.com/300x180" alt="Card">-->
<!--            </div>-->
<!--            <button class="btn">Aggiungi Carta</button>-->
<!--        </div>-->

<!--        <div class="quick-transaction">-->
<!--            <h3>Transazione Rapida</h3>-->
<!--            <div class="contacts">-->
<!--                <img src="https://via.placeholder.com/40" alt="Contatto">-->
<!--                <img src="https://via.placeholder.com/40" alt="Contatto">-->
<!--                <img src="https://via.placeholder.com/40" alt="Contatto">-->
<!--                <img src="https://via.placeholder.com/40" alt="Contatto">-->
<!--            </div>-->
<!--            <input type="text" placeholder="‚Ç¨ Importo">-->
<!--            <button class="btn">Invia</button>-->
<!--        </div>-->

<!--        <div class="my-goals">-->
<!--            <h3>I miei obiettivi</h3>-->
<!--            <div class="goal">Nuovo PC <span>500 ‚Ç¨</span></div>-->
<!--            <div class="goal">Vacanza <span>1.200 ‚Ç¨</span></div>-->
<!--        </div>-->
<!--    </aside>-->
</div>

<div th:replace="fragments/footer :: footer"></div>

<script th:src="@{/js/profileIcon.js}"></script>
<script th:src="@{/js/chart.js}"></script>
</body>
</html>
